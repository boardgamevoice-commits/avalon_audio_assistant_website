## Avalon Audio Assistant PRD

### 版本信息
- 文档版本：v1.0
- 撰写日期：2025-11-10
- 产品负责人：待定
- 适用应用版本：1.0.0

---

### 1. 概述
**产品定位**  
Avalon Audio Assistant 是一款专注于语音主持与规则讲解的 iOS 桌游助手，聚焦阿瓦隆、狼人杀系列等推理类桌游，提供双语语音引导、流程管理和辅助工具，帮助玩家与主持人在家中或桌游吧迅速进入游戏状态。

**背景与机会**
- 推理类桌游规则复杂、流程长，新手入门成本高。
- 线下游戏常缺经验主持，影响体验。
- 现有语音助手多为跨平台泛用方案，缺少针对桌游的流程管理与双语支持。

**产品目标**
- 支撑纯语音规则讲解、全流程主持、互动法官三大核心玩法。
- 通过双语语音与简洁 UI 降低新手门槛，提升聚会效率。
- 以可扩展 JSON 元数据管理不同桌游内容，为后续扩充奠定基础。

**成功指标（KPI）**
- 新用户首周有效主持场次 ≥ 2 场
- 单场平均语音步骤播放次数 ≥ 25 次
- 引导流程完成率（从开始到结束）≥ 75%
- 语音设置功能使用率 ≥ 40%
- 正向反馈评分（App Store 评论/反馈问卷）≥ 4.5/5

---

### 2. 目标用户与场景
**用户画像**
- 普通桌游玩家：熟悉游戏但希望有语音辅助提升氛围。
- 新手玩家：首次接触推理桌游，需要标准化教程。
- 桌游吧工作人员：需要快速主持多局游戏，保证体验一致。

**核心场景**
- 家庭/朋友聚会：客厅环境，设备为 iPhone / iPad。
- 桌游吧：主持人通过蓝牙音箱播放语音，引导多桌游戏。
- 自助语音法官：玩家自主持，依赖 App 给出流程与判定提示。

---

### 3. 产品范围与优先级
**Must-have**
- 游戏库内置三类模式：规则讲解、主持流程、互动法官（均随游戏 JSON 绑定）。
- 支持 `阿瓦隆`、`一夜终极狼人`、`狼人杀（标准局）`，按 JSON 配置加载。
- 语音资源优先使用预录制 MP3，缺失时调用第三方 TTS（系统内置或可扩展）。
- 双语界面与语音播放切换（简体中文/英文），语言默认跟随系统，可在设置页调整。
- 核心流程导航：选择游戏 → 配置（人数/角色/语言确认） → 语音引导。
- 引导页提供语音播放控制、文字同步、工具栏（随机玩家、计时器、骰子模拟器、记分板）。
- 角色头像与语音资源按游戏存储于本地 `avatars/`、`audio/` 目录，缺失语音自动回退 TTS。
- 语音设置页记录用户偏好（优先级：本地存储，含音量、语速、语音源选择）。
- 错误及异常以 Debug 模式中文日志输出。
- 基础统计埋点（流程完成率、语音设置使用等）。
- 免责声明：游戏内容为非官方教育用途，可能涉及版权风险。

**Should-have**
- 互动法官模式：在夜间/判定节点提供分支选择与口播提示。
- 多段语音合成缓存机制，减少 TTS 重复调用。
- 语音播放历史记录（最近步骤重播、跳转）。

**Could-have**
- 语音角色皮肤（不同主持风格/音色）。
- 语音指令控制（“下一步”“重播”）。
- 线下赛事模式（支持多局排程、导出结果）。

**Won’t-have（v1.0）**
- 用户自定义游戏/指令。
- 线上实时房间同步。
- 账号登录、云同步、社交分享。
- 付费订阅或内购。

---

### 4. 用户需求与故事
| ID | 用户类型 | 场景/故事 | 优先级 | 验收标准 |
|----|----------|-----------|--------|----------|
| US-01 | 玩家 | 想快速了解某游戏规则，通过语音听完关键流程 | Must | 进入讲解模式，完成播放并可随时重播当前段 |
| US-02 | 主持人 | 按 App 指示带队游戏，不遗漏夜间指令 | Must | 引导页按 JSON 顺序播报，提供上下步骤控制 |
| US-03 | 主持人 | 在嘈杂环境中需要更大音量与个性化语速 | Must | 设置页可调节语速/音量/语音源并保存 |
| US-04 | 玩家 | 希望看到同步文字内容辅助理解 | Must | 每段语音对应文字快照，支持中英文切换 |
| US-05 | 玩家 | 夜间需要法官判断特殊互动（如狼人杀场景判定） | Should | 互动法官模式提供分支提示与相关音效 |
| US-06 | 玩家 | 希望随机决定发言顺序、控制发言时间 | Must | 工具栏提供随机玩家按钮、倒计时功能 |
| US-07 | 产品团队 | 需要在不发版情况下更新游戏内容 | Should | 新增 JSON 后可被 App 识别，支持热启动加载 |
| US-08 | 运营 | 未来便于接入插页/激励广告 | Should | 预留广告位与触发逻辑，正式上线前可隐藏 |
| US-09 | 用户 | 担心版权问题，希望 App 提供声明 | Must | 设置或关于页展示版权免责声明 |

---

### 5. 核心流程与信息架构
**信息架构**
```
Home
 ├── Game Detail (规则简介 & 配置)
 │     ├── Player Count
 │     └── Role Setup
 ├── Settings
 │     └── Voice Preferences & Language
 ├── Downloads (语音资源管理，可选)
 └── About & Legal (免责声明、隐私)
```

**主要流程**
1. 首页：展示游戏卡片，支持双语显示。
2. 游戏详情：展示该游戏支持的语音流程与预计时间，无需额外模式选择。
3. 配置流程：选择玩家人数 → 角色配置（JSON 提供默认推荐）。
4. 语音引导：序列播放，显示文本与可视化进度。
5. 工具栏：随机玩家弹窗、计时器模态层、骰子模拟器、记分板。
6. 设置：语音源（录制/TTS）、音量/语速、下载管理、语言切换。

---

### 6. 功能设计
#### 6.1 首页
- 展示所有支持游戏，卡片含图标、简介、人数范围、语言跟随系统显示。
- 支持按热门/最新排序，未来可用运营配置。
- 入口提供快速访问最近使用的游戏。

#### 6.2 游戏详情页
- 展示该游戏的规则简介、推荐使用场景、预计时长。
- 自动加载与游戏绑定的流程模式，展示内容说明但无需选择。
- 提供“立即开始”进入配置流程。

#### 6.3 配置流程
- 人数选择：Stepper + 输入框，按 JSON `minPlayers/maxPlayers` 限制。
- 角色配置：默认推荐配置，允许增减；系统提供提示但不阻止任意组合。
- 预览摘要：展示已选角色、关键规则提示及角色头像（优先加载 `avatars/<gameId>/<roleId>.png`）。

-#### 6.4 语音引导页
- 核心区域：纵向指令时间线占据主要视图区域，展示流程中的全部指令；每条只显示对应语音文本，当前项加粗放大并保持高亮，无需独立卡片；保持垂直滚动行为。
- 控制按钮：固定三枚——上一条、主控按钮、下一条。主控按钮在流程进行时显示“暂停”，在暂停时显示“播放”，流程全部结束后显示“重播”并重新从第一条开始。
- 暂停逻辑：暂停会立即停止当前音频与倒计时/静默计时器，但保持当前步骤；再次点击“播放”从该步骤头部重新播放并重新计算等待时间。
- 播放状态提示：取消底部波形可视化模块，在“当前游戏”卡片内的播放状态文本旁增加播放器状态图标（播放/暂停/静默等）。
- 语音播放：优先播放 `audio/<gameId>/<stepId>_<language>.mp3` 预录音频；若文件缺失则调用 TTS（提前缓存或实时合成）。
- 互动法官模式：在需要用户判断时弹窗选择（如“是否有狼人被淘汰”），根据选择跳转对应步骤。
- 状态处理：页面关闭时自动停止语音、计时器。
- 异常：音频不存在或 TTS 失败时，文字保持显示，并播报失败提示音，调试日志输出中文说明。

#### 6.5 语音设置页
- 语音源：`预录音频` / `系统 TTS`，若选择 TTS 可选择语言、音色（系统提供）。
- 音量、语速滑杆，范围明示。
- “试听”按钮使用示例文本演示设置效果。
- 设置保存至本地（`UserDefaults`），区分全局与游戏专属（可选）。
- 记录 TTS 下载进度（若需要离线语音包）。

- #### 6.6 工具
- Toolbox 主界面仅展示四个工具入口（`Random Player`、`Timer`、`Dice Roller`、`Scoreboard`）的卡片/按钮，附带简要描述与图标。点击任一入口会在同层以 modal/sheet 形式打开对应工具，工具关闭后回到入口列表。
- 随机玩家（独立弹窗）：支持设置参与人数上限（默认读取当前引导会话 playerCount），从 1~N 中随机抽取 1 位；提供“重新抽取”“排除已抽到玩家”选项，并保留最近 5 次抽取历史（可撤销）。
- 计时器（独立弹窗）：提供正计时与倒计时模式切换。倒计时内置 30s / 60s / 90s 预设快捷键，同时允许手动输入自定义时长（1s-30min），倒计时结束触发提示音与轻量震动（若设备支持）；正计时支持暂停、恢复与重置。
- 骰子模拟器（独立弹窗）：支持 1-4 枚骰子，面数可在 6/8/10/12 间快速切换，亦可手动指定 6-12 的自定义面数。投掷后展示单个骰子点数与总和，可再次投掷或锁定部分骰子重掷。
- 记分板（独立弹窗）：允许主持人添加/删除玩家并编辑昵称（默认使用“Player X”），每位玩家显示当前得分。提供 `+` / `-` 按钮增减分数（范围 -99~999），支持快速归零、重新排序（按得分降序）、记分历史日志（最近 5 条）。进场自动读取配置流程中的玩家数量作为默认条目（可扩展）。

#### 6.7 数据内容与 JSON 结构
- 参考 `avalon.json`，字段包括：`id`、本地化名称、简介、角色、推荐配置、指令步骤。
- 指令步骤包含：`stepId`、文本（中/英）、`condition`（逻辑条件）、等待时长、倒计时等。
- 互动法官额外字段：`branchOptions`（用户选择项）、`nextStep`。
- 所有 JSON 由开发者维护，发布前需进行 Schema 校验。
- 静态资源目录约定：角色头像位于 `avatars/<gameId>/<roleId>.png`，可选多尺寸；预录音频位于 `audio/<gameId>/<stepId>_<language>.mp3`，留空代表使用 TTS。

#### 6.8 商业化预留
- v1.0 免费，无广告。
- 预留插页广告触发点（如单局结束）与激励广告入口（如解锁额外音效）。
- 正式接入前屏蔽广告模块，后续版本可在设置页开启。

#### 6.9 免责声明与合规
- 在 `About` 页展示：  
  “Avalon Audio Assistant 为非官方教育用途工具，提供的规则与语音仅供学习、研究与个人娱乐使用。相关桌游版权归原权利人所有。如涉及侵权请联系处理。”
- 语音素材由团队录制或使用 TTS 合成，确保版权自有或遵循服务条款。
- 收集数据仅限匿名使用统计，不上传个人隐私。

---

### 7. 技术方案
**平台与框架**
- iOS 原生开发：Swift + SwiftUI。
- 最低支持 iOS 16。
- 使用 Combine 或 Swift Concurrency 管理状态与异步。

**核心模块**
- `GameRepository`：加载本地 JSON，解析为模型。
- `AudioEngine`：统一封装 MP3 播放（AVAudioPlayer）与 TTS（AVSpeechSynthesizer）。
- `GuideViewModel`：维护当前步骤、语音状态、分支逻辑。
- `VoicePreferencesService`：管理用户语音设置。
- `ToolboxManager`：随机、计时器等工具控制。

**资源管理**
- 角色头像随 App 打包存放 `avatars/`，预录音频存放 `audio/`（若文件夹为空则依赖 TTS）。
- TTS 缓存按 `gameId + stepId + language` 组合存储，避免重复合成。
- JSON 更新需随 App 版本发布（暂不支持远程下发）。

**调试与日志**
- 使用自定义 Debug Logger，关键错误输出中文信息。
- 记录异常流程（如 JSON 解析失败、音频缺失），方便 QA 排查。

---

### 8. 数据与埋点
| 事件 | 触发时机 | 关键属性 |
|------|----------|----------|
| `game_selected` | 用户选择游戏 | `gameId`, `language`, `mode` |
| `config_confirmed` | 完成人数/角色配置 | `gameId`, `playerCount`, `roles` |
| `guide_step_played` | 播放某步骤 | `gameId`, `stepId`, `language`, `source`(mp3/tts) |
| `voice_preference_saved` | 保存语音设置 | `language`, `source`, `speed`, `volume` |
| `tool_used` | 随机玩家/计时器等 | `toolType`, `gameId` |
| `branch_selected` | 互动法官选择 | `gameId`, `stepId`, `optionId` |
| `session_completed` | 流程结束 | `gameId`, `mode`, `duration`, `stepsCount` |
| `feedback_clicked` | 用户尝试反馈 | `entryPoint` |

---

### 9. 风险与缓解
| 风险 | 影响 | 概率 | 对策 |
|------|------|------|------|
| 桌游版权争议 | 下架风险、法律压力 | 中 | 明确免责声明；规避官方素材；应对投诉通道 |
| 语音资源不足 | 体验不一致 | 中 | 核心流程优先录制；缺失项使用 TTS 并标记补录计划 |
| JSON 配置错误 | 流程中断 | 中 | 上线前跑自动化校验；运行时容错并显示提示 |
| TTS 合成延迟 | 播放卡顿 | 中 | 异步预加载、缓存机制、UI 提示加载状态 |
| 背景噪音导致听不清 | 体验下降 | 中 | 提供音量控制、继续优化音频质量、建议外接音箱 |
| iPad 适配不足 | 影响桌游吧使用 | 低 | SwiftUI 自适应布局；QA 覆盖 iPhone/iPad |

---

### 10. 运营策略
- 内容迭代：每季度新增 1 款桌游或扩展流程；收集玩家建议。
- 社区合作：与桌游吧、社群团体合作，提供试用与反馈渠道。
- 推广节奏：上线后通过桌游论坛、社交媒体、短视频示范流程。
- 用户反馈：App 内提供反馈入口，48 小时内响应。
- 数据驱动：跟踪热门游戏与模式使用情况，指导内容优先级。

---

### 11. 里程碑计划
| 阶段 | 时间 | 目标 |
|------|------|------|
| M0 需求冻结 | 2025-11-20 | 完成 PRD 审核、原型交付 |
| M1 原型与可行性验证 | 2025-12-20 | SwiftUI 高保真原型、音频流程 POC、JSON 解析器 Demo |
| M2 开发 Alpha | 2026-01-31 | 完成 Must-have 功能，内部联调，核心游戏语音录制 |
| M3 Beta 测试 | 2026-03-15 | 封测，收集反馈，优化语音/互动法官体验 |
| M4 上线准备 | 2026-04-15 | App Store 物料、免责声明、隐私政策、灰度上线 |
| GA 正式发布 | 2026-04-30 | App Store 上线，启动推广 |
| Post GA v1.1 | 2026-06 | 接入广告模块、扩充游戏库 |

---

### 12. 验收标准
- Must-have 功能全覆盖，Should-have 完成 ≥ 70%。
- 核心流程无 P0/P1 Bug（单元测试覆盖率 ≥ 70%，重点场景手测）。
- 语音播放首次响应 < 400ms（已缓存情况下 < 150ms）。
- TTS 失败回退机制生效，无崩溃。
- 用户测试（≥ 10 组玩家）满意度 ≥ 4/5。
- 免责声明、隐私声明符合 App Store 审核要求。

---

### 13. 附录
- 参考资料：`/Users/devfang/Cursor/Avalon_Audio_Assistant/other_PRD.md`
- JSON 示例：`/Users/devfang/Cursor/Avalon_Audio_Assistant/avalon.json`
- 录音规范与脚本模板、测试用例计划（待补充）。

